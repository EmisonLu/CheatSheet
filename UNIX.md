# UNIX

## 系统

`passwd`：更改口令

`lock`：锁住终端

Ctrl+D、`logout`、`exit`：退出系统

`command &`：将命令command放在后台执行，用户不必等到这条命令执行结束

## 文件

文件类型：普通文件、目录文件、特别文件、命名管道

目录结构：

* 根目录root，用`/`表示
* 绝对路径名：以`/`开头；相对路径名：不以`/`开头
* `..`：向根目录方向攀登一级
* `.`：当前目录的绝对路径名(在某些必须指定绝对路径名的场合，可使用其代指工作目录)
* 目录名`.`、`..`：把文件系统连接在一起的”黏合剂“
* `~`：home目录

文件存取控制模式：

* rwxrwxrwx：文件所有者(user)、同组用户(group)、其它用户(other)
* 只有文件所有者可以改变文件的访问权限

## 通配符

`?`：匹配除'/'外的单个字符，在方括号内不是通配符

`*`：匹配任意字符串，包括空串，在方括号内不是通配符

`[abc]`：匹配a或b或c

`[a-c]`：ASCII连续字符中的任意一个，’-‘仅在方括号内作为通配符

`[0-13]`：匹配0或1或3

隐式文件第一个点必须显示匹配

只能在一个目录内匹配文件名

## 正则表达式

用于确定字符串模式的一个规则集

特殊符号：

* `.`：能与除换行符之外的行内任何字符相匹配
* `*`：匹配前一字符的零次或多次出现(含前面)
* `+`：前面的字符必须至少出现一次(含前面)
* `?`：前面的字符最多只可以出现一次(含前面)
* `\`：用于改变特殊符号的含义，也可后跟一字符的八进制数表示
* `[]`：定义字符类，匹配方括号内的任何一个字符
  * `-`：指示字符的范围
  * `\`：转义符
  * `^`：紧跟在左方括号后，匹配所有不出现在方括号内的字符
* `^`：如出现在正则表达式首，则表示行首，^的下一个字符串应当是行首的第一个字符串
  * `^begin`，仅当`begin`出现在行首才匹配
* `$`：如出现在正则表达式末尾，则表示行尾
* `""`：其内字符在匹配时忽视其特殊含义
* `\<`：字首匹配
* `\>`：字尾匹配
* `\s`：匹配所有空白符，包括换行
* `\S`：匹配非空白符，不包括换行
* `\w`：匹配字母、数字、下划线。等价于 [A-Za-z0-9_]
* `()`：标记一个子表达式的开始和结束位置，将所有选择项括起来
* `{n}`：n 是一个非负整数，匹配确定的 n 次。
  * `o{2}`不能匹配`Bob`中的`o`，但是能匹配`food`中的两个`o`
* `{n,}`：n 是一个非负整数，至少匹配n次
* `{n,m}`：m和n均为非负整数，其中n≤m，最少匹配n次且最多匹配m次

```
Example

[0-9]*		表示任意多个数字
.*				与包含空串在内的任何字符串相匹配

```

匹配规则：

* 正则表达式总是尽可能与最长的字符串相匹配
* 一个正则表达式不排斥另一个正则表达式
* 空正则表达式`//`代表最后那次使用的正则表达式
* 在替换字符串中，符号`&`取正则表达式所匹配的搜索字符串的值

加标记的括号和加标记的数字：

* 可用加标记的括号`\( \)`将正则表达式括起来，可嵌套，正则表达式不匹配加标记的括号
* 加标记的数字`\n`取第n次出现的以`\(`开头的加括号的正则表达式所匹配的字符串

## cat

`cat > file`：读取用户输入至文件file中（每次都会新建，覆盖掉原来的）

`cat >> file`：不覆盖，添加到尾部

`cat < file`、`cat file`：显示文件内容

`cat < file1 > file2`、`cat file1 > file2`：复制文件

`cat file1 file2 | sort`：把file1、file2的数据连接起来，输出送至管道一端，sort命令从管道另一端读入并排序

`-v`：使控制字符也显示出来

## ls

`ls [-选项] [文件名表]`

`-l`：长列表，文件类型、文件权限、链接数、文件所有者、组名、文件大小、修改日期等

* 第一列：
  * -：普通文件
  * d：目录
  * b：块特别文件
  * c：字符特别文件
  * p：命名管道
  * l：符号链接文件

`-t`：按文件的修改时间顺序列出所有文件

`-r`：按文件或文件名的逆序排列

`-a`：将以“.”开始的隐文件名显示出来

`-F`：若文件为目录，则其名后放一"/"；若文件为可执行文件，则其名后放一"*"；若符号链接，则其名后放一"@"

`-b`：用八进制数\ddd表示形式显示不可打印的字符

`-i`：在第一域列出I节字号

选项可组合，如`-al`

## mkdir

`mkdir [-m 权限模式] 目录名`：默认777

建立目录项要对父目录有写权限

## rmdir

`rmdir [-p] 目录名`：只有当一个目录为空，才能删除

`-p`：如果删除指定的目录后父目录为空，那它也被删除

## cp

`cp 文件名1 文件名2`：用文件1复制文件2，若文件2已存在，则原始内容丢失，可带路径

`cp 文件... 目录`：将一个或多个文件复制到另一个目录，文件和目录都要已存在

`cp -r 目录1 目录2`：将目录1及其所有内容复制到目录2下

`-i`：在覆盖一个已存在的文件时事先获得确认

`-p`：复制文件时保留源文件的修改时间和权限方式

## mv

与`cp`前两种类似，区别是源文件不复存在

`mv 目录名1 目录名2`：目录改名

## rm

`rm [-fi] 文件...`：删除文件

`rm -r [-fi] 目录...`：删除目录

`-f`：强制，即使文件写保护，也不要求用户确认

`-i`：对话方式，删除任何一个文件都要求用户确认

## ln

`ln 文件名 新文件名`：对一个文件建立链接，使用其它文件名与一个文件实体建立链接

`ln 文件... 目录`：在另一个目录为一个或多个文件建立同名链接

以上为硬链接，系统建立的是不同文件名与同一个文件实体的链接

以下为软链接，建立的是新的文件或目录与原来文件或目录的路径名映射，速度稍慢

`ln -s ......`

## diff

`diff [-bie] 文件1 文件2`：以编辑指令的形式逐行显示两个文件的差异

```
n1 a n2,n3
> 显示文件2中n2~n3的那些行

n1,n2 d n3
< 显示文件1中n1~n2的那些行

n1,n2 c n3,n4
< 显示文件1中n1~n2的那些行
---
> 显示文件2中n3~n4的那些行
```

`-b`：忽略由于空格及制表符而引起的差异

`-i`：忽略字母的大小写差异

`-e`：产生一个编辑手稿，UNIX的编辑程序可用它来由文件1建立文件2

## file

`file 文件...`：判断一个文件是否为正文，还是二进制文件

## find

`find 目录 [条件] [操作]`：常用目录为“.”，在目录树中自上而下递归查找满足条件的文件

条件：

* `-atime [+|-]n`：指定文件的存取时间
* `-mtime [+|-]n`：指定文件的修改时间
* `-name 文件名`：查找的文件名，若文件名含通配符，必须予以转义
* `-type 字符`：指定由字符表示的文件类型
  * `f`：普通文件
  * `d`：目录
  * `c`：字符设备文件
  * `b`：块设备文件
  * `p`：管道文件

操作：

* `-print`：打印找到文件的带有路径的文件名
* `-exec`：对找到文件要执行的shell命令，"{}"为找到文件的占位符，末尾为转义的分号
* `-ok`：类似`-exec`，但在执行命令前，打印命令和参数，等待用户确认

`-a`：多个条件(操作)逻辑与，默认

`-o`：多个条件(操作)逻辑或

```
Example

打印当前目录子树中所有以.c.old结尾的文件
find . -name "*.c.old" -print
find . -name \*.c.old -print

打印当前目录子树中7天前修改过的C源程序名
find . -name \*.c -mtime +7 -print

打印/usr目录子树中所有以.sav结尾的文件和core文件
find /usr \(-name \*.sav -o -name core \) -print

打印当前目录子树下的全部文件
find . -print

-print可以通过执行echo命令实现
find . -exec echo {} \;

删除一星期以前的新闻项
find /usr/news -mtime +7 -exec rm {} \;
```

## chown

`chown 新属主 文件...`：将一个文件或目录的属主改变成另一个注册用户

只有文件原属主或超级用户才能改变文件的属主

`chown -r 新属主 目录`：用于递归改变目录以及该目录下的所有文件和子目录的属主

## chmod

改变文件所有者、组用户、其它用户对文件或目录的存取许可证，只有文件所有者和超级用户有权改变文件存取权

`chmod 模式 文件...|目录...`

两种模式：

* 八进制数表示：读：4；写：2；执行：1，`chmod 777 file`
* 符号表示：
  * u：文件所有者；g：同组用户；o：其它用户；a：所有用户
  * +：添加存取许可；-：取消存取许可；=：取消该文件的原有存取许可
  * r：读许可；w：写许可；x：执行许可；s：执行时置进程的有效用户标识数为文件所有者的标识数
  * `chmod ug+w file`

## umask

`umask [3位八进制数]`：新建文件的实际权限为创建时的权限值减去umask指定的八进制数值

## echo

`echo [-n] 参数表`：显示命令行中的字符串常数、Shell变量值、产生诊断信息、向管道发送数据等

`-n`：在输出一行后不换行

”*“会被扩展，若要使用需要用"\\"或单引号括起来，双引号没用

## more

`more [+起始行号]|[+/初始查找模式] [文件]`：一次一屏显示文件

more内部命令：

* 空格键：显示下一屏
* Enter键：显示下一行
* nf：向下移动n屏，n为数字
* nb：向上移动n屏，n为数字
* /模式：向下查找指定的字符串模式
* n：重复前面查找命令
* =：显示当前行号
* h：显示more所有命令的帮助信息
* q：退出more

## pg

与more类似，Enter键显示下一屏，在输入每个命令后必须按下Enter键

## head

`head [-显示行数] 文件`：显示文件的开始部分，默认10行

`tail [+起始行] 文件`、`tail [-起始行] 文件`：默认10行

从文件第51行起显示到第70行：`head -70 file | tail -20`

## lp

`lp [-mvc] [-d 打印机名] [-t 标题] 文件...`：打印文件

## lpstat

`lpstat [-p 打印机名表] [-u 用户名表]`：检查打印队列的状态

## cancel

`cancel 作业号表`

`cancel 打印机名表`

`cancel -u 用户标识符`

## pr

`pr [-h 标题] [-l 每页行数] [文件...]`：从标准输入或文件中读取数据，并产生带有日期、标题和页号的分页输出

```
Example

对文件进行格式化后通过管道输出到lp程序以便进行打印
pr file | lp

若pr的输入来自管道，则没有文件名，最好使用-h选项指定打印标题
cat file1 file2 | pr -h 'file1 and file2' | lp
```

## od

`od [格式] [文件] [位移量]`：以各种格式显示二进制文件的内容

格式：

* `-b`：二进制数
* `-o`：八进制数，默认
* `-d`：十进制数
* `-x`：十六进制数
* `-c`：ASCII

位移量：控制从文件中的哪个位置开始显示

## sort

排序文件或合并已排序的文件

`sort [-fdnbri] [+位置 [-位置]] [-o 输出文件] [输入文件]`：排序

* `-f`：对字母大小写不做区别
* `-d`：按字典排序
* `-n`：按数值排序
* `-b`：当指定排序字段时，忽视作为界符的所有空白字符的值
* `-r`：反序
* `-i`：在非数值比较时，ASCII码范围040~176之外的非打印字符不予理会
* `-o`：指定输出文件，输出文件与输入文件可同名

`sort [-cmu] [-o 输出文件] 已排序文件...`：合并

* `-c`：检查输入文件，验证是否是已排序文件，是，才产生输出
* `-m`：合并已排好序的输入文件，并不再检验各文件本身是否有序，以提高执行效率

## grep fgrep egrep

可以在输入数据中查找包含指定模式的所有行，并将这些行写至标准输出

* fgrep：查找固定字符串
* grep：查找固定字符串或使用通配符
* egrep：支持正则表达式查找，推荐使用

`grep [-inwr] 模式 [文件...]`

* `-i`：忽略大小写字母的差别
* `-n`：在输出中添加相关行号，便于在文件中定位
* `-w`：指定只匹配完整的字，不匹配一个字的子串部分
* `-r`：选择所有不包括指定模式的行

grep使用的正则表达式是有限正则表达式

由于正则表达式的元字符与Shell元字符部分重叠，因此习惯上都用单引号括住字符串模式

```
Example

ls -l | grep '^.......rw'		在当前目录列出其它用户能读写的文件
```

egrep在正则表达式上有扩充规则，如括号作为字符组、`|`表示或

## sed

以非交互方式根据命令表自动地对文件或输入流进行编辑，然后将编辑后的行送至标准输出

`sed [-n] -f 命令文件 [文件...]`

`sed [-n] 命令表 [文件...]`

* `-f`：从命令文件中读出命令
* `-n`：不复制文本行到标准输出

sed每次读入一行，根据命令表处理行的内容，然后将编辑后的行送至标准输出

sed命令表由一行或多行组成，每行格式为：`[地址[,地址]] 命令 [参数表]`

地址：

* 若地址默认，sed处理文件中所有行
* `1,3`，从第一行到第三行
* 地址可以是正则表达式，选择包含和表达式匹配的行，作地址的正则表达式必须用斜线界定

命令：

* `d`：将sed所选出的文本行删去
* `a`：将一行或若干行加到当前选择的行后
* `c`：类似于`a`，但它用文本行替代选择行
* `s`：替换命令，格式为`[地址[,地址]] s/模式/替换串/[g] [p]`
* `g`：替换选择行上所有重复出现的模式
* `p`：将所有替换后送至输出
* `w file`：将输出送至指定文件
* `q`：sed立即退出处理

## awk

一种模式查找和处理的语言，支持面向字段或域的操作，UNIX中功能最强的过滤器

语句和表达式与C语言类似

`awk [-F 分隔符] '程序' [文件...]`

`awk [-F 分隔符] -f 程序文件 [文件...]`

程序格式：

`模式 { 执行动作 }`

`模式 { 执行动作 }`

`...`

## cut

裁剪指定的列

`cut -c 列表 [文件...]`

* 截取文件中从第1列至第10列，第20列至第30列的信息：`cut -c 1-10, 20-30 file`

`cut [-d '分隔符'] -f 字表段 [-s] [文件...]`：默认分隔符为制表符

## paste

`paste [-d 分隔符] [文件表...]`：与cut相反，将包括一列(或多列)数据的若干文件组合成多列的大文件

在文件参数中使用`-`可用于代替文件名，表示从标准输入中读入一行，如`ls | paste ----`，以4栏形式列出目录

## tee

读取标准输入，并将它转送到标准输出及一个或多个文件

`-i`：tee不理会中断

`-a`：使得tee将输出添加到文件的后面

## date

`date [-u] [+format]`：显示日期和时间

`date mmddHHMM [[yy]yy]`：超级用户可指定参数设置日期和时间

* `mm`：月份
* `dd`：日期
* `HH`：小时
* `MM`：分钟
* `[yy]yy`：2位或4位的年份

## df

`df [-t][-f] [设备名 | 目录 | RFS/NFS资源]`：显示在任何已安装了的设备或包含指定目录的设备或远程网络文件系统还剩下多少自由空间(以块为单位)

* `-t`：显示已使用的块数及自由块数，并带总计
* `-f`：只显示自由块数
* `-k`：显示以k字节为单位的自由空间数

df命令允许参数为文件系统或安装了文件系统的目录名

## du

`du [-ars] [目录名]`：报告一个目录连同它所有文件和子目录使用的磁盘空间(以块为单位)

* `-a`：显示目录中每个文件使用磁盘空间的情况
* `-r`：报告无法打开的目录和无法读的文件信息
* `-s`：只统计所有文件及子目录所占空间的总数

## stty

`stty [-a] [-g] [参数]`：用于设置不同的参数，使得系统能正确地使用终端

## tar

`tar key[vf] [目录|文件]...`：建立档案文件或从档案中抽出文件

key只能取下面关键字中的一个：

* `c`：建立一个新的档案带，将原先带上的文件清除
* `r`：将文件添加在磁带上原档案之后，保留原带上文件
* `x`：从磁带上读出文件
* `t`：显示磁带上文件表内容
* `v`：在tar读或写时列出每个文件
* `f`：使tar从f后的参数中读或写
* `o`：使读取文件的用户和用户组成为文件的用户ID和组ID，而不是磁带上原来的ID

```
Example

打包：tar -cvf [目标文件名].tar [原文件名/目录名]
解包：tar -xvf [原文件名].tar
```

## who

`who`：显示当前登录在系统中的用户名，使用的终端号、登录时间及其它信息

## logname

`logname`：返回调用进程的用户名

## id

`id`：显示调用进程的ID和名字，也显示组名和组ID

## ps

`ps`：显示进程的状态，输出的各栏信息为进程标识、终端标识、累计执行时间、启动进程的命令

* `-f`：用于显示进程全部信息
* `-u 用户ID`：显示用户的所有进程的状态
* `-g 组ID`：显示用户组的所有进程的状态
* `-e`：显示当前运行的每一个进程的信息

## sleep

`sleep time`：挂起一段时间，以秒为单位

Shell通过创建一个新进程来执行sleep命令

## time

`time 命令 [命令参数]`：命令执行完成后，time程序显示命令运行所用的总时间，系统花费的时间和命令的纯执行时间

## wait

`wait [n]`：Shell本身(不通过创建新进程的方法)执行wait，等待进程号为n的后台进程终止，并报告它的终止状态。如默认参数n，则等待Shell上所有当前活动的后台进程终止，并返回代码0

## kill

当一个前台进程在运行时，一般可用Ctrl+C组合键终止它，但对后台进程这个方法是无效的，终止后台进程可用如下命令

`kill [-signal] pid... | -gid`

如果用负号指明一个组标识数，那么对应该组标识数的所有进程被选中

## nohup

`nohup 命令[命令参数]`：以此方式执行命令，用户按了中断键或者退出登录都不会中断命令的继续执行，适用于重要的或需长时间运行的程序的执行

## env

`env [-] [name=value] ... [命令]`：设置命令的执行环境，env取得当前的环境，并根据给出的参数对其进行修改

在命令执行之前，name=value所定义的变量和值被合并到所继承的环境中，标志'-'使所继承的环境完全被忽视

如没指定参数，env显示取得的环境

## zip

压缩当前目录下的所有文件，产生一个标志的zip压缩文件allfile.zip：`zip allfile.zip *`

将某一目录中的部分文件添加进压缩文件：`zip allfile.zip -i file`

产生与压缩格式PKZIP兼容的压缩文件：`zip -k allfile.zip *`

解开经zip压缩的文件，可使用unzip命令，原压缩文件是不会被覆盖的：`unzip files.zip`

可用`-x`选项指明某些文件不用解开，可用`-d`选项为被解开的文件指定存放目录：`unzip files.zip -x somefile -d dirname`

如果只想用压缩文件中的较新文件覆盖目录中已过时文件，则可用刷新选项`-f`：`unzip -f files.zip -d dirname`

## gzip

`gzip [-flrt] [文件名]`

* `-f`：即使已存在扩展名为`.gz`的压缩文件或多连接文件也能进行正常压缩
* `-l`：显示压缩前和压缩后文件的大小，压缩比
* `-r`：能用递归方法压缩目录树
* `-t`：检查压缩文件的完整性

使用gzip产生压缩文件files.tar.gz，并覆盖原始文件files.tar：`gzip files.tar`

要保留原始文件，可使用`-c`选项，并给出输出的压缩文件名：`gzip -c files.tar > files.tar.gz`

可将多个文件压缩到一个文件中去：

1. `gzip -c file1 > files.gz`，`gzip -c file2 >> files.gz`
2. `gzip -c file1 file2 > files.gz`
3. `cat file1 file2 | gzip > files.gz`

`gunzip files.tar.gz`、`gzip -d files.tar.gz`：产生解压缩文件，并覆盖压缩文件

## man

`man 命令名`：用于访问联机手册，显示使用有关命令的文档

## cb

`cb [-s] [-l leng] [旧C源程序文件]`：使C程序的排版格式规范化，以建立统一的C源程序档案